<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <script>
    let s = " 3+21*2 "
    var calculate = function (s) {
      //去除所有空格
      //1.遍历字符串，将数字存入栈中
      //如果是是‘+’，则将后一个数字压入栈中
      //如果是‘-’，则将相反数压入栈中
      //如果是‘*’或者‘/’则将栈顶元素与 符号后一个元素进行计算，将栈顶元素弹出，并将结果压入栈中
      //最后将栈中元素相加
      let stack = []
      let num = 0
      let operation = '+'
      //去除所有空格
      let s1 = ''
      for (let i of s) {
        if (i !== ' ') {
          s1 += i
        }
      }
      for (let i = 0; i < s1.length; i++) {
        if (!isNaN(s1[i])) {
          //这一步很关键，有可能出现连续的数字
          num = num * 10 + Number(s1[i])
        }
        if (isNaN(s1[i]) || i === s1.length - 1) {
          switch (operation) {
            case '+': stack.push(num); break;
            case '-': stack.push(-num); break;
            case '*': stack.push(stack.pop() * num); break;
            case '/': stack.push(Math.floor(stack.pop() / num)); break;
          }
          operation = s[i];
          num = 0;
        }
      }
      console.log(stack)
      return stack.reduce((pre, cur) => { return pre + cur })
    };
    console.log(calculate(s))
  </script>
</body>

</html>